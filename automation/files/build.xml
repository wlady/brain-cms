<project name="Deploy Files" default="build" basedir=".">
    <echo>${ant.project.name}</echo>
    <taskdef resource="net/sf/antcontrib/antlib.xml" classpath="/usr/share/java/ant/ant-contrib.jar"></taskdef>

    <!-- Getting server domain name from file (which generated by jenkins) -->
    <property file=".automation_server_domain"/>

    <target name="build" description="deploy files" >
        <loadfile property="textFile" srcfile="${basedir}/.files"/>
        <loadfile property="filesToReplaceHostName" srcfile="${basedir}/.files_to_replace_host_name"/>

        <sequential>
            <foreach param="line" list="${textFile}" delimiter="${line.separator}" target="copy" />

            <!-- Replacing of domain name in configuration files -->
            <foreach
                    param="src"
                    list="${filesToReplaceHostName}"
                    delimiter="${line.separator}"
                    target="replace_host_name"/>
        </sequential>
    </target>

    <target name="copy" description="copy file" >
        <propertyregex property="src" input="${line}" regexp="([^=]*)=([^=]*)" select="\1" />
        <propertyregex property="dst" input="${line}" regexp="([^=]*)=([^=]*)" select="\2" />
        <copy file="${src}" tofile="../../${dst}" overwrite="true" />
    </target>

    <target name="replace_host_name" description="replacing host name in some files" >
        <replace
                file='../../${src}'
                token='%automation_server_domain%'
                value='${automation_server_domain}'/>
        <echo>file "../../${src}" processed</echo>
    </target>
</project>
